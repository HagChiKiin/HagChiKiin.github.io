<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Legacy IT Agent</title>

    <link rel="icon" type="image/png" sizes="16x16" href="/image/favicon-16x16.png">

    <!-- Link google font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;400;500;700;900&amp;display=swap"
          rel="stylesheet">

    <!-- Link bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <!-- Link icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
          integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g=="
          crossorigin="anonymous" referrerpolicy="no-referrer">

    <!--    toastr.js-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css"
          integrity="sha512-vKMx8UnXk60zUwyUnUPM3HbQo8QfmNx7+ltw8Pm5zLusl1XIfwcxo8DbWCqMGKaWeNxWA8yrx5v3SaVpMvR3CA=="
          crossorigin="anonymous" referrerpolicy="no-referrer">

    <!-- Components CSS -->

    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet">


    <!-- Link tự viết -->
    <link rel="stylesheet" type="text/css" th:href="@{/css/style-admin.css}">
</head>

<body>
<!--HEADER-->
<div class="header">
    <div class="logo">
        <a href="#">
            <img th:src="@{/img/techjobs_bgw.png}" style="width: 100px" alt="logo">
        </a>
    </div>

    <div class="sidebar ms-5">
        <div class="menu">
            <ul>
                <li class="menu-item">
                    Quản lý công việc <span><i class="fa-solid fa-caret-down"></i></span>

                    <ul class="sub-menu">
                        <li class="sub-menu-item">
                            <a href="/recruiter/jobs">Danh sách công việc</a>
                        </li>
                        <li class="sub-menu-item">
                            <a href="/recruiter/jobs-create">Tạo công việc</a>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</div>

<!-- BODY -->
<div class="job-container mt-4 mb-4">
    <div class="container">
        <div class="mb-4">
            <a href="/recruiter/jobs" class="btn-custom btn-refresh">
                <span><i class="fa-solid fa-angle-left"></i></span>
                Quay lại
            </a>
        </div>

        <div class="job-list-inner p-2">
            <ul class="nav nav-tabs mb-4" id="myTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active fw-bold" id="job-tab" data-bs-toggle="tab" data-bs-target="#job"
                            type="button" role="tab" aria-controls="job" aria-selected="true">Chi tiết công
                        việc
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link fw-bold" id="applicant-tab" data-bs-toggle="tab"
                            data-bs-target="#applicant" type="button" role="tab" aria-controls="applicant"
                            aria-selected="false">Danh sách ứng viên
                    </button>
                </li>
            </ul>
            <div class="tab-content" id="myTabContent">
                <div class="tab-pane fade show active" id="job" role="tabpanel" aria-labelledby="job-tab">
                    <div class="d-flex justify-content-between mb-4">
                        <button class="btn-custom btn-update-job">
                            <span><i class="fa-solid fa-plus"></i></span>
                            Cập nhật
                        </button>
                        <button class="btn-custom btn-delete-job bg-danger">
                            <span><i class="fa-solid fa-trash-can"></i></span>
                            Xóa
                        </button>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="mb-3">
                                <label for="name" class="form-label">Công ty</label>
                                <select type="text" class="form-control" id="name" name="name">
                                    <option th:each="recruiter : ${recruiterList}" th:text="${recruiter.name}">

                                    </option>
                                </select>
                            </div>

                            <form th:each="job : ${jobList}">
                                <div class="mb-3">
                                    <label for="title" class="form-label">Tên công việc</label>
                                    <input type="text" class="form-control" id="title" name="title"
                                           th:text="${job.title}">
                                </div>
                                <div class="mb-3">
                                    <label for="dueDateTime" class="form-label">Hạn nộp</label>
                                    <input type="datetime-local" class="form-control" id="dueDateTime"
                                           name="dueDateTime" th:text="${job.dueDateTime}">
                                </div>
                                <div class="mb-3">
                                    <label for="location" class="form-label">Địa chỉ</label>
                                    <input type="text" class="form-control" id="location" name="location"
                                           th:text="${job.location}">
                                </div>
                                <div class="mb-3">
                                    <label for="jobStatus" class="form-label">Trạng thái</label>
                                    <select type="text" class="form-control" id="jobStatus" name="jobStatus">
                                        <option>OPEN</option>
                                        <option>ONGOING_INTERVIEWS</option>
                                        <option>HIRED</option>
                                        <option>CLOSED</option>
                                        <option>CANCELLED</option>
                                    </select>

                                </div>
                                <div class="mb-3">
                                    <label for="yoe" class="form-label">Kinh nghiệm</label>
                                    <input type="number" class="form-control" id="yoe" name="yoe" th:text="${job.yoe}">
                                </div>
                                <div class="mb-3">
                                    <label for="skill" class="form-label">Kỹ năng</label>
                                    <select id="skill" class="form-control" multiple="multiple" name="skill">
                                        <option value="Javascript">Javascript</option>
                                        <option value="Java">Java</option>
                                        <option value="Golang">Golang</option>
                                        <option value="PHP">PHP</option>
                                        <option value="React">React</option>
                                        <option value="AWS">AWS</option>
                                        <option value="Devops">Devops</option>
                                        <option value=".Net">.Net</option>
                                        <option value="Vue">Vue</option>
                                        <option value="Angular">Angular</option>
                                        <option value="Python">Python</option>
                                        <option value="C#">C#</option>
                                        <option value="SQL">SQL</option>
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <label for="salaryFrom" class="form-label">Mức lương từ</label>
                                    <input type="number" class="form-control" id="salaryFrom" name="salaryFrom"
                                           th:text="${job.salaryFrom}">
                                </div>
                                <div class="mb-3">
                                    <label for="salaryTo" class="form-label">đến</label>
                                    <input type="number" class="form-control" id="salaryTo" name="salaryTo"
                                           th:text="${job.salaryTo}">
                                </div>
                                <div class="mb-3">
                                    <label for="literacy" class="form-label">Trình độ học vấn</label>
                                    <select type="text" class="form-control" id="literacy" name="literacy">
                                        <option>UNIVERSITY</option>
                                        <option>COLLEGE</option>
                                        <option>INTERMEDIATE</option>
                                        <option>NONE</option>
                                    </select>
                                </div>
                            </form>
                        </div>
                        <div class="col-md-9" th:each="job : ${jobList}">
                            <div class="mb-3">
                                <label for="benefit" class="form-label">Phúc lợi</label>
                                <textarea rows="10" class="form-control" id="benefit" name="benefit"
                                          th:text="${job.benefit}"></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="detail" class="form-label">Mô tả công việc</label>
                                <textarea rows="10" type="text" class="form-control" id="detail" name="detail"
                                          th:text="${job.detail}"></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="requirement" class="form-label">Yêu cầu công việc</label>
                                <textarea rows="10" type="text" class="form-control" id="requirement" name="requirement"
                                          th:text="${job.requirement}"></textarea>
                            </div>

                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="applicant" role="tabpanel" aria-labelledby="applicant-tab">

                    <table class="table applicant-table">
                        <thead>
                        <tr>
                            <th>STT</th>
                            <th>Tên ứng viên</th>
                            <th>Mô tả ngắn</th>
                            <th>Link CV</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td>1</td>
                            <td>Noah Lott</td>
                            <td class="w-50">Deleniti praesentium laborum et fugiat ea enim aliquid corporis
                                architecto soluta numquam beatae earum quae ad id ut recusandae aut eveniet et
                                aliquam voluptate voluptatem totam deleniti quia est eveniet qui porro quam
                                blanditiis harum molestias impedit et veritatis voluptas magni voluptate nisi
                                porro eveniet rem esse sit perspiciatis qui.
                            </td>
                            <td><a href="" target="_blank">Xem chi tiết</a></td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>Penny Bunn</td>
                            <td class="w-50">Qui ab et provident quo architecto sint voluptatum error dolorem
                                consequatur iusto ut libero occaecati et harum accusantium non veritatis eum
                                sunt perferendis repellendus quasi illum dignissimos quia ea in quaerat facere
                                dicta in vero ut qui distinctio vitae velit quis quae eveniet iure saepe
                                laboriosam qui sint quas magnam sunt omnis id dicta.
                            </td>
                            <td><a href="" target="_blank">Xem chi tiết</a></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
        integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<!-- axios -->
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

<!--  toastr.js-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"
        integrity="sha512-VEd+nq25CkR676O+pLBnDW09R7VQX9Mdiij052gVCp5yVH3jGtH70Ho/UUv4mJDsEdTvqRCFZg0NKGiojGnUCw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="/js/main.js"></script>
<!-- Components JS -->

<script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script>
    $(document).ready(function () {
        $("#skill").select2();
    });
</script>
<script>
    // Step 1: Add an event listener to the "Cập nhật" (Update) button
    const updateJobButton = document.querySelector(".btn-update-job");
    updateJobButton.addEventListener("click", toggleEditMode);

    // Step 2: Function to fetch job details from the backend
    function getJobDetails(id) {
        return axios.get(`/recruiter/jobs/${id}`); // Replace with your API endpoint to fetch job details
    }

    // Step 3: Function to populate the form fields with the fetched data
    function populateForm(job) {
        const nameInput = document.getElementById("name");
        const titleInput = document.getElementById("title");
        const dueDateTimeInput = document.getElementById("dueDateTime");
        const locationInput = document.getElementById("location");
        const jobStatusInput = document.getElementById("jobStatus");
        const yoeInput = document.getElementById("yoe");
        const skillInput = document.getElementById("skill");
        const salaryFromInput = document.getElementById("salaryFrom");
        const salaryToInput = document.getElementById("salaryTo");
        const literacyInput = document.getElementById("literacy");
        const benefitTextarea = document.getElementById("benefit");
        const detailTextarea = document.getElementById("detail");
        const requirementTextarea = document.getElementById("requirement");

        nameInput.value = job.recruiterId;
        titleInput.value = job.title;
        dueDateTimeInput.value = job.dueDateTime;
        locationInput.value = job.location;
        jobStatusInput.value = job.jobStatus;
        yoeInput.value = job.yoe;

        // Trigger Select2 update after populating the "skill" field (if using Select2)
        $("#skill").val(job.skills).trigger("change"); // Assuming your job object contains the skills field as an array of skill names
    }

    // Step 4: Function to handle edit mode toggle
    let editMode = false;

    async function toggleEditMode() {
        if (!editMode) {
            const jobId = /* Replace with the current job's ID */; // You need to get the current job's ID from the URL or any other source
            try {
                const response = await getJobDetails(jobId);
                const job = response.data;
                populateForm(job);
                editMode = true;
                updateJobButton.innerText = "Lưu"; // Change the button text to "Lưu" (Save)
            } catch (error) {
                console.error("Error fetching job details:", error);
            }
        } else {
            // Perform the save/update logic here (e.g., call another API to update the job details)
            // After successfully updating the job, you can set editMode back to false and change the button text back to "Cập nhật"
            editMode = false;
            updateJobButton.innerText = "Cập nhật";
        }
    }
</script>


</body>

</html>